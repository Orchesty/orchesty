.base-status-service:
  variables:
    DIR: pf-bundles
    IMAGE: ${REGISTRY}/${IMAGE_PREFIX}status-service
  rules:
    - if: '$FORCE_PIPELINE =~ /ALL/ || $FORCE_PIPELINE =~ /status-service/'
    - if: '$CI_COMMIT_BEFORE_SHA == $_BANNED_RUN_ALL_SHA'
      when: never
    - changes:
      - ${DIR}/**/*


status-service:build:
  stage: build
  needs: []
  extends:
    - .base-kaniko-build
    - .base-status-service

  script:
    - cp .dockerignore ../.dockerignore
    - executor --context ../ --destination ${IMAGE}:${TAG_DIR_CH} --destination ${IMAGE}:${TAG_BRANCH} --cache=true

status-service:test:
  stage: test
  needs: []

  extends:
    - .base-go-test # todo: don't use go-test
    - .base-starting-point
