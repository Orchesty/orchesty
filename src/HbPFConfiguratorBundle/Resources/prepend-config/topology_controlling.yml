# STATUS SERVICE
rabbit-mq:
    exchanges:
        pipes.topology.controlling:
            durable: true
            type: direct

    queues:
        pipes.topology.controlling:
            durable: true
            bindings:
                - exchange: pipes.topology.controlling
                  routing_key: pipes.topology.controlling

    consumers:
        topology-controlling:
            class: Hanaboso\PipesFramework\Configurator\TopologyControlling\TopologyControllingConsumer
            queue: pipes.topology.controlling
            serializer: Hanaboso\PipesFramework\RabbitMq\Serializers\JsonSerializer
            callback: hanaboso.pipes_framework.configurator.topology_controlling.topology_controlling_callback

    producers:
        topology-destroy:
            class: Hanaboso\PipesFramework\Configurator\TopologyControlling\TopologyControllingProducer
            content_type: application/json
            exchange: pipes.topology.controlling
            routing_key: pipes.topology.controlling
            serializer: Hanaboso\PipesFramework\RabbitMq\Serializers\JsonSerializer

services:
    # callback for topology controlling
    hanaboso.pipes_framework.configurator.topology_controlling.topology_controlling_callback:
        class: Hanaboso\PipesFramework\Configurator\TopologyControlling\TopologyControllingCallback
        calls:
            - [setRepeater, ['@hanaboso.pipes_framework.commons.rabbit_mq.repeater.repeater']]
            - [setLogger, ['@monolog.logger.rabbit-mq']]
        arguments: ['@hbpf.handler.generator_handler']
